<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>P-Librus - Oceny</title>
  <style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(to right, #dfe9f3, #ffffff);
    margin: 0;
    padding: 0;
    color: #333;
  }

  .header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 30px;
    background: linear-gradient(to right, #d4dce4, #f2f3f5);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .logo {
    display: flex;
    align-items: center;
  }
  .logo img {
    height: 40px;
    margin-right: 10px;
  }
  .logo span {
    font-size: 24px;
    color: #8a2e6e;
    font-weight: bold;
  }

  .user-info {
    font-size: 14px;
  }

  .menu {
    display: flex;
    justify-content: center;
    padding: 10px;
    background-color: #edf0f3;
    flex-wrap: wrap;
  }
  .menu-item {
    margin: 10px;
    position: relative;
  }
  .menu-item a {
    font-size: 14px;
    padding: 10px 15px;
    background-color: #ffffff;
    border: 1px solid #ccc;
    border-radius: 10px;
    box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
    text-decoration: none;
    color: black;
    transition: background-color 0.3s;
    display: block;
  }
  .menu-item a:hover {
    background-color: #f0f0f0;
  }
  .badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: red;
    color: white;
    font-size: 10px;
    padding: 2px 5px;
    border-radius: 50%;
  }

  .container {
    padding: 40px;
    background: #ffffff;
    margin: 30px auto;
    border-radius: 15px;
    max-width: 1000px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  }

  h2 {
    color: #2a6f97;
  }

  label {
    font-weight: 600;
    display: block;
    margin-top: 15px;
    color: #34495e;
  }

  select, textarea, button {
    width: 100%;
    padding: 10px;
    margin-top: 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
  }

  button {
    background: #2a6f97;
    color: white;
    border: none;
    border-radius: 7px;
    cursor: pointer;
    margin-top: 20px;
    font-weight: bold;
    transition: background 0.3s;
  }

  button:hover {
    background: #1b4965;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 30px;
    background: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
  }

  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #ccc;
  }

  th {
    background: #e0e0e0;
    color: #333;
  }

  .tabela-klasy {
    margin-bottom: 60px;
  }

  .student {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
  }
  .student span {
    width: 150px;
    font-weight: 500;
  }

  .grade {
    position: relative;
    display: inline-block;
    margin: 0 3px;
  }

  .grade .tooltip {
    visibility: hidden;
    width: 200px;
    background-color: #333;
    color: #fff;
    text-align: left;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    margin-left: -100px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .grade:hover .tooltip {
    visibility: visible;
    opacity: 1;
  }

  /* Typy ocen */
  .typ-Sprawdzian       { background-color: #ffccbc; color: black; }
  .typ-Pracaklasowa     { background-color: #ffe0b2; color: black; }
  .typ-Kartkówka        { background-color: #fff59d; color: black; }
  .typ-Projekt          { background-color: #b3e5fc; color: black; }
  .typ-Prezentacja      { background-color: #d1c4e9; color: black; }
  .typ-Pracanalekcji    { background-color: #dcedc8; color: black; }
  .typ-Odpowiedźustna   { background-color: #f8bbd0; color: black; }
  .typ-Zadanie          { background-color: #c8e6c9; color: black; }
  .typ-Inne             { background-color: #90caf9; color: black; }
  .typ-Przewidywana     { background-color: #cfd8dc; color: black; }
  .typ-Roczna           { background-color: #b0bec5; color: black; }
  .typ-Poprawa          { background-color: #ffab91; color: black; }
  .typ-Aktywność        { background-color: #f0f4c3; color: black; }
  .typ-Pracadomowa      { background-color: #e6ee9c; color: black; }
  .typ-Półroczna        { background-color: #e0f7fa; color: black; }
  .typ-Egzamin          { background-color: #E6DAF0; color: black; }

  /* Modal */
  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .modal-content {
    background: white;
    padding: 20px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    border-radius: 10px;
    position: relative;
  }

  .modal-content button.close-modal {
    position: absolute;
    top: 10px;
    right: 15px;
    background: crimson;
    color: white;
    border: none;
    padding: 5px 10px;
    font-size: 14px;
    border-radius: 5px;
    cursor: pointer;
  }
.modal-content .container {
  max-width: 100%;
  width: 100%;
}

.modal-content select,
.modal-content textarea,
.modal-content button,
.modal-content .student {
  width: 100%;
}


  .ukryte {
    display: none;
  }
  
  .student button {
  padding: 4px 8px;
  font-size: 14px;
  background-color: #4caf50;
  color: white;
  border-radius: 5px;
}
.btn-plus {
  all: unset;
  display: inline-block;
  width: 24px;
  height: 24px;
  font-size: 16px;
  font-weight: bold;
  text-align: center;
  line-height: 24px;
  border-radius: 4px;
  background-color: #4caf50;
  color: white;
  margin-left: 6px;
  cursor: pointer;
  transition: background-color 0.2s, transform 0.1s;
}

.btn-plus:hover {
  background-color: #388e3c;
  transform: scale(1.1);
}


</style>

</head>
<body>

</script>
  <div class="header">
    <div class="logo">
      <img src="21 maj 2025, 16_13_32.png" alt="P-Librus logo">
      <span>P-Librus</span>
    </div>
    <div class="user-info">
      Zalogowany jako: <strong>Piotr Rejmentowski (nauczyciel)</strong>
    </div>
    <select>
      <option selected>polski</option>
      <option>english</option>
    </select>
  </div>

  <div class="menu">
    <div class="menu-item"><a href="indywidualni.html">Indywidualni</a></div>
    <div class="menu-item"><a href="Lekcja.html">Lekcja</a></div>
    <div class="menu-item"><a href="Oceny.html">Oceny</a><div class="badge">5</div></div>
    <div class="menu-item"><a href="organizacja.html">Organizacja</a><div class="badge">3</div></div>
    <div class="menu-item"><a href="wiadomosci.html">Wiadomości</a></div>
    <div class="menu-item"><a href="Ogloszenia.html">Ogłoszenia</a><div class="badge">1</div></div>
    <div class="menu-item"><a href="Terminarz.html">Terminarz</a><div class="badge">6</div></div>
  </div>

 <div class="container" id="wybor-klasy">
  <h2>Wybierz klasę</h2>
  <table>
    <thead>
      <tr>
        <th>Klasa</th>
        <th>Półroczna</th>
        <th>Przewidywana</th>
        <th>Roczna</th>
        <th>Akcja</th>
      </tr>
    </thead>
    <tbody id="listaKlasTabela"></tbody>
  </table>
</div>




<div id="modalOceny" class="modal">
  <div class="modal-content">
    <button class="close-modal" onclick="zamknijModal()">Zamknij</button>
    <div id="panelOceny" class="container">
	
	  <h2>PANEL NAUCZYCIELA OCEN</h2>
<br>
  <h3>Dodaj nowe oceny</h3>	
  <label for="klasa">Klasa:</label>
  <select id="klasa"></select>



  <label for="typ">Typ oceny:</label>
  <select id="typ">
    <option>Sprawdzian</option>
    <option>Praca klasowa</option>
    <option>Kartkówka</option>
    <option>Projekt</option>
    <option>Prezentacja</option>
    <option>Praca na lekcji</option>
    <option>Odpowiedź ustna</option>
    <option>Zadanie</option>
    <option>Inne</option>
    <option>Przewidywana</option>
    <option>Roczna</option>
    <option>Poprawa</option>
    <option>Aktywność</option>
    <option>Praca domowa</option>
    <option>Egzamin</option>
    <option>Półroczna</option>
  </select>

  <label for="komentarz">Komentarz:</label>
  <textarea id="komentarz" rows="2" cols="50"></textarea>

  <div class="students" id="students"></div>

  <button onclick="zapiszOceny()">Zapisz ocenę</button>
  <br>

  <label for="sortowanie">Sortuj oceny według:</label>
  <select id="sortowanie" onchange="pokazTabele()">
    <option value="domyślnie">Domyślnie</option>
    <option value="data">Data</option>
    <option value="typ">Kategoria</option>
    <option value="ocena">Wartość oceny</option>
  </select>

  <h2>Tabela ocen dla klasy</h2>
  <div id="tabeleKlas"></div>
</div>

    </div> <!-- koniec panelOceny -->
  </div> <!-- koniec modal-content -->
</div> <!-- koniec modal -->

  <!-- [Twój kod aż do <script>] -->

<script>
    const klasy = {
      '6F-Język_Piotrowski': ['Ola', 'Julia', 'Natan', 'Filip'],
    '6J-Język_Piotrowski': ['Zuzia', 'Kasia', 'Maja'],
    '7A-Język_Piotrowski': ['Agata', 'Tadeusz', 'Piotr'],
    '7B-Język_Piotrowski': ['Gosia', 'Grzesiek', 'Agnieszka', 'Adam'],
    '7C-Język_Piotrowski': ['Wiesia', 'Alina', 'Bożena', 'Halinka'],
    '8D-Język_Piotrowski': ['Mirek', 'Ela', 'Ula'],
    '8E-Język_Piotrowski': ['Ola', 'Maria', 'Marta'],
	'1G-Język_Piotrowski': ['Jagoda', 'Szymon', 'Antek', 'Lena'],
	'2H-Język_Piotrowski': ['Andrzej', 'Maciej', 'Patryk'],
	'6F-Biologia': ['Ola', 'Julia', 'Natan', 'Filip'],
	'6J-Biologia': ['Zuzia', 'Kasia', 'Maja'],	
	'4I-Przyroda': ['Tymek','Tosia','Dobromiła','Kasjan'],
	'Edukacja_ogólna': ['Julia','Ola','Zuzia','Tadeusz','Grzesiek','Adam','Wiesia','Bożena','Jagoda','Antek','Maciej','Tosia']
    };
  window.addEventListener('DOMContentLoaded', () => {


const listaKlasTabela = document.getElementById('listaKlasTabela');


Object.keys(klasy).forEach(nazwaKlasy => {
  const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
  const oceny = zapisane[nazwaKlasy] || [];

  const maPolroczna = oceny.some(o => o.typ === 'Półroczna');
  const maPrzewidywana = oceny.some(o => o.typ === 'Przewidywana');
  const maRoczna = oceny.some(o => o.typ === 'Roczna');

  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td>${nazwaKlasy}</td>
    <td>${maPolroczna ? '✅' : '❌'}</td>
    <td>${maPrzewidywana ? '✅' : '❌'}</td>
    <td>${maRoczna ? '✅' : '❌'}</td>
    <td><button class="wybierz-klase-btn" data-klasa="${nazwaKlasy}">Wybierz</button></td>
  `;
  listaKlasTabela.appendChild(tr);
});

    const ocenyMozliwe = ['BZ', 'NP', '-', '+', '1', '1+','2-','2','2+','3-', '3','3+', '4-', '4','4+', '5-','5', '5+', '6-','6'];
    const selectKlasa = document.getElementById('klasa');
    const studentsDiv = document.getElementById('students');
    const tabeleKlasDiv = document.getElementById('tabeleKlas');

    for (let klasa in klasy) {
      const option = document.createElement('option');
      option.value = klasa;
      option.textContent = klasa;
      selectKlasa.appendChild(option);
    }

    function pokazUczniow() {
      studentsDiv.innerHTML = '';
      const wybranaKlasa = selectKlasa.value;
      klasy[wybranaKlasa].forEach(uczen => {
        const div = document.createElement('div');
        div.className = 'student';
        div.innerHTML = `
  <span>${uczen}</span>
  <select id="ocena-${uczen}">
    <option value="">-</option>
    ${ocenyMozliwe.map(o => `<option value="${o}">${o}</option>`).join('')}
  </select>
`;


        studentsDiv.appendChild(div);
      });
    }

    function zapiszOceny() {
      const typ = document.getElementById('typ').value;
      const komentarz = document.getElementById('komentarz').value;
      const klasa = selectKlasa.value;
      if (!klasa) return alert('Wybierz klasę');

      const oceny = klasy[klasa].map(uczen => {
        const select = document.getElementById(`ocena-${uczen}`);
        return {
          uczen,
          ocena: select.value,
          typ,
          komentarz,
          data: new Date().toLocaleDateString()
        };
      });

      const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
      if (!zapisane[klasa]) zapisane[klasa] = [];
      zapisane[klasa].push(...oceny.filter(o => o.ocena !== ''));
      localStorage.setItem('oceny', JSON.stringify(zapisane));
      pokazUczniow();
      pokazTabele();
      alert('Oceny zapisane!');
    }

    function edytujOcene(klasa, uczen, index) {
      const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
      const ocenyUcznia = zapisane[klasa].filter(o => o.uczen === uczen);
	  const sortuj = document.getElementById('sortowanie')?.value || 'domyślnie';

if (sortuj === 'data') {
  // sortowanie od najnowszej do najstarszej
  ocenyUcznia.sort((a, b) => new Date(b.data) - new Date(a.data));
} else if (sortuj === 'typ') {
  // sortowanie alfabetyczne wg typu (kategorii)
  ocenyUcznia.sort((a, b) => a.typ.localeCompare(b.typ));
} else if (sortuj === 'ocena') {
  // sortowanie malejąco po wartości liczbowej
  const getVal = x => isNaN(parseInt(x.ocena)) ? 0 : parseInt(x.ocena);
  ocenyUcznia.sort((a, b) => getVal(b) - getVal(a));
}


      const ocenaDoEdycji = ocenyUcznia[index];
      if (!ocenaDoEdycji) return;

      const nowaOcena = prompt('Nowa ocena:', ocenaDoEdycji.ocena);
      if (nowaOcena === null) return;

      const nowyTyp = prompt('Nowy typ oceny:', ocenaDoEdycji.typ);
      if (nowyTyp === null) return;

      const nowyKomentarz = prompt('Nowy komentarz:', ocenaDoEdycji.komentarz || '');
      if (nowyKomentarz === null) return;

      ocenaDoEdycji.ocena = nowaOcena;
      ocenaDoEdycji.typ = nowyTyp;
      ocenaDoEdycji.komentarz = nowyKomentarz;

      localStorage.setItem('oceny', JSON.stringify(zapisane));
      pokazTabele();
      alert('Ocena zaktualizowana.');
    }

    function pokazTabele() {
  const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
  const wybranaKlasa = selectKlasa.value;
  tabeleKlasDiv.innerHTML = '';

  if (!zapisane[wybranaKlasa]) return;

  const table = document.createElement('table');
  table.classList.add('tabela-klasy');

  let html = `<thead><tr>
  <th>Uczeń</th>
  <th>Oceny</th>
  <th>Średnia</th>
  <th>Proponowana</th>
  <th>(I)</th>
  <th>(II)</th>
  <th>(R)</th>
</tr></thead><tbody>`;



  klasy[wybranaKlasa].forEach(uczen => {
    let ocenyUcznia = zapisane[wybranaKlasa].filter(o => o.uczen === uczen);

    // 🔽 SORTOWANIE 🔽
    const sortuj = document.getElementById('sortowanie')?.value || 'domyślnie';
    if (sortuj === 'data') {
      ocenyUcznia.sort((a, b) => new Date(b.data.split('.').reverse().join('-')) - new Date(a.data.split('.').reverse().join('-')));
    } else if (sortuj === 'typ') {
      ocenyUcznia.sort((a, b) => a.typ.localeCompare(b.typ));
    } else if (sortuj === 'ocena') {
      const getVal = x => isNaN(parseInt(x.ocena)) ? 0 : parseInt(x.ocena);
      ocenyUcznia.sort((a, b) => getVal(b) - getVal(a));
    }

    const polroczna = ocenyUcznia.find(o => o.typ === 'Półroczna')?.ocena || '';
    const przewidywana = ocenyUcznia.find(o => o.typ === 'Przewidywana')?.ocena || '';
    const roczna = ocenyUcznia.find(o => o.typ === 'Roczna')?.ocena || '';

    const liczby = ocenyUcznia
      .filter(o => !isNaN(parseInt(o.ocena)) && !['Przewidywana', 'Roczna', 'Półroczna'].includes(o.typ))
      .map(o => parseInt(o.ocena));
    const srednia = liczby.length ? (liczby.reduce((a, b) => a + b, 0) / liczby.length).toFixed(2) : '';
let proponowana = '';
if (srednia) {
  const s = parseFloat(srednia);
  if (s >= 5.70) proponowana = '6';
  else if (s >= 4.70) proponowana = '5';
  else if (s >= 3.70) proponowana = '4';
  else if (s >= 2.70) proponowana = '3';
  else if (s >= 1.70) proponowana = '2';
  else proponowana = '1';
}

    const ocenyHTML = ocenyUcznia.map((o, idx) => {
      const klasaTypu = `typ-${o.typ.replace(/\s/g, '')}`;
      return `
        <span class="grade ${klasaTypu}" style="cursor:pointer;" onclick="edytujOcene('${wybranaKlasa}', '${uczen}', ${idx})">
          ${o.ocena}${o.typ.toLowerCase() === 'poprawa' ? '*' : ''}
          <div class="tooltip">${o.typ}\n${o.komentarz}\n${o.data}</div>
        </span>`;
    }).join(' ');

   html += `<tr>
  <td>
    ${uczen}
    <button class="btn-plus" onclick="otworzModalJednegoUcznia('${uczen}')">➕</button>
  </td>
  <td>${ocenyHTML}</td>
  <td>${srednia}</td>
  <td>${proponowana}</td>
  <td>${polroczna}</td>
  <td>${przewidywana}</td>
  <td>${roczna}</td>
</tr>`;


  });

  html += '</tbody>';
  table.innerHTML = `<caption><strong>Klasa ${wybranaKlasa}</strong></caption>` + html;
  tabeleKlasDiv.appendChild(table);
}


    selectKlasa.selectedIndex = 0;
    pokazUczniow();
    pokazTabele();

        window.pokazUczniow = pokazUczniow;
    window.pokazTabele = pokazTabele;
    window.zapiszOceny = zapiszOceny;
    window.edytujOcene = edytujOcene;
  }); 
  
  document.addEventListener('click', e => {
  if (e.target.classList.contains('wybierz-klase-btn')) {
    const klasa = e.target.getAttribute('data-klasa');
    otworzModal(klasa);
  }
});
let uczenDoOceny = '';

function otworzModalJednegoUcznia(uczen) {
  uczenDoOceny = uczen;
  document.getElementById('modal-uczen-nazwa').textContent = uczen;
  document.getElementById('modalJednegoUcznia').style.display = 'flex';
}

function zamknijModalJednego() {
  document.getElementById('modalJednegoUcznia').style.display = 'none';
}

function zapiszOceneJednego() {
  const typ = document.getElementById('typ-jednego').value;
  const komentarz = document.getElementById('komentarz-jednego').value;
  const ocena = document.getElementById('ocena-jednego').value;
  const klasa = document.getElementById('klasa').value;

  if (!ocena) return alert('Wybierz ocenę.');

  const nowaOcena = {
    uczen: uczenDoOceny,
    ocena,
    typ,
    komentarz,
    data: new Date().toLocaleDateString()
  };

  const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
  if (!zapisane[klasa]) zapisane[klasa] = [];
  zapisane[klasa].push(nowaOcena);
  localStorage.setItem('oceny', JSON.stringify(zapisane));

  pokazTabele();
  zamknijModalJednego();
  alert('Ocena zapisana!');
}

</script>

  <!-- Firebase App (core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>

<script>
  window.otworzModal = (klasa) => {
    const selectKlasa = document.getElementById('klasa');
    selectKlasa.value = klasa;

    document.getElementById('modalOceny').style.display = 'flex';

    if (typeof pokazUczniow === 'function') pokazUczniow();
    if (typeof pokazTabele === 'function') pokazTabele();
  };

  window.zamknijModal = () => {
    document.getElementById('modalOceny').style.display = 'none';
  };
</script>
<div id="modalJednegoUcznia" class="modal">
  <div class="modal-content">
    <button class="close-modal" onclick="zamknijModalJednego()">Zamknij</button>
    <h3>Dodaj ocenę dla <span id="modal-uczen-nazwa"></span></h3>

    <label for="typ-jednego">Typ oceny:</label>
    <select id="typ-jednego">
      <option>Sprawdzian</option>
      <option>Praca klasowa</option>
      <option>Kartkówka</option>
      <option>Projekt</option>
      <option>Prezentacja</option>
      <option>Praca na lekcji</option>
      <option>Odpowiedź ustna</option>
      <option>Zadanie</option>
      <option>Inne</option>
      <option>Przewidywana</option>
      <option>Roczna</option>
      <option>Poprawa</option>
      <option>Aktywność</option>
      <option>Praca domowa</option>
      <option>Egzamin</option>
      <option>Półroczna</option>
    </select>

    <label for="komentarz-jednego">Komentarz:</label>
    <textarea id="komentarz-jednego"></textarea>

    <label for="ocena-jednego">Ocena:</label>
    <select id="ocena-jednego">
  <option value="">-</option>
  <option value="BZ">BZ</option>
  <option value="NP">NP</option>
  <option value="-">-</option>
  <option value="+">+</option>
  <option value="1">1</option>
  <option value="1+">1+</option>
  <option value="2-">2-</option>
  <option value="2">2</option>
  <option value="2+">2+</option>
  <option value="3-">3-</option>
  <option value="3">3</option>
  <option value="3+">3+</option>
  <option value="4-">4-</option>
  <option value="4">4</option>
  <option value="4+">4+</option>
  <option value="5-">5-</option>
  <option value="5">5</option>
  <option value="5+">5+</option>
  <option value="6-">6-</option>
  <option value="6">6</option>
</select>


    <button onclick="zapiszOceneJednego()">Zapisz ocenę</button>
  </div>
</div>

<footer style="text-align: center; padding: 20px; background-color: #f0f0f0;">
  <div style="margin-bottom: 10px;">
    <img src="teamppp.png" alt="Team P" style="width: 200px; margin: 0 20px;">
    <img src="21 maj 2025, 16_13_32.png" alt="p-librus" style="width: 200px; margin: 0 20px;">
    <img src="stpschool.png" alt="STP School" style="width: 200px; margin: 0 20px;">
  </div>
  <p style="font-size: 14px; color: #555;">P-Librus © 2025</p>
</footer>
</body>
</html>

